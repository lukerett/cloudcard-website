<!--
?SQF_PLAN_TYPE=Plus&SQF_PLAN_SIZE=12500&SQF_PLAN_PRICE=230
?SQF_PLAN_TYPE=Starter
-->

<script
  src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
  integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
  crossorigin="anonymous"></script>

  <div class="sqs-block-content">
    <h2>Selected Plan:</h2>
    <p id="loading-plan-details">Loading plan details...</p>
    <ul id="plan-details" style="display: none;">
      <li><strong>Type:&nbsp;</strong><span id="plan-type">???</span></li>
      <li><strong>Size:</strong>&nbsp;<span id="plan-size">???</span></li>
      <li><strong>Price:</strong>&nbsp;<span id="plan-price">???</span><span id="billed-annually"><br/>(billed annually)</span></li>
    </ul>
  </div>

  <!-- requires header.html to be injected into the page or site header -->
  <script>
    $( document ).ready( function() {
      var planType = getParameterByName('SQF_PLAN_TYPE');
      $('#plan-type').text(planType);
      if (planType === 'Starter') {
        $('#plan-size').text('10 photos/day');
        $('#plan-price').text('Free Forever');
        $('#billed-annually').hide();
      } else {
        $('#plan-size').text(getParameterByName('SQF_PLAN_SIZE') + ' requests/year');
        $('#plan-price').text('$' + getParameterByName('SQF_PLAN_PRICE') + '/mo');
        $('#billed-annually').show();
      }
      $('#loading-plan-details').hide();
      $('#plan-details').show();

      var submitButton = $("input[type=submit]");
      $("input:text[name='email']").on('change', function() {
        if (isBlacklisted(this.value)) {
          $(this).parent().addClass('error');
          disable(submitButton);
        } else {
          $(this).parent().removeClass('error');
          enable(submitButton);
        }
      });
    });

    function isBlacklisted(email) {
      var failures = 0;
      [
        'gmail\\.com', 
        'yahoo\\.com',
        'yahoo\\.in',
        'earthlink\\.net',
        'hotmail\\.com',
        'icloud\\.com',
        'me\\.com',
        'outlook\\.com',
        'aol\\.com',
        'hotmail\\.com',
        'mail\\.com',
        'email\\.com',
        'yandex\\.com',
        'protonmail\\.com',
        'verizon\\.net'
      ].forEach(function(domain) {
          var re = new RegExp("^[\\w.+\\-]+@" + domain + "$");
          if (re.test(String(email).toLowerCase())) failures++;
      });
      return failures > 0;
    }

    function disable(button) {
      button.attr('disabled','disabled');
      button.css({ 'background-color' : 'gray', 'border-color' : 'gray', 'opacity' : '0.5' });
    }

    function enable(button) {
      button.removeAttr('disabled');
      button.css({ 'background-color' : '', 'border-color' : '', 'opacity' : '' });
    }
  </script>
